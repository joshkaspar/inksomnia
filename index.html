<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Truchet Tile Experiments</title>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f2f2f2;
        color: #111;
      }
      .toolbar {
        position: sticky;
        top: 0;
        z-index: 10;
        display: flex;
        gap: 8px;
        align-items: center;
        padding: 10px 12px;
        background: #fff;
        border-bottom: 1px solid #ddd;
      }
      #sketch-name {
        min-width: 280px;
        padding: 4px 6px;
      }
      button {
        padding: 5px 10px;
        cursor: pointer;
      }
      #status {
        font-size: 13px;
        color: #444;
      }
      main {
        padding: 10px 12px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/p5.min.js"></script>
  </head>
  <body>
    <div class="toolbar">
      <label for="sketch-name">Sketch</label>
      <select id="sketch-name"></select>
      <button id="load-btn" type="button">Load Sketch</button>
      <span id="status"></span>
    </div>
    <main id="canvas-host"></main>

    <script>
      const selectEl = document.getElementById("sketch-name");
      const statusEl = document.getElementById("status");
      const loadBtn = document.getElementById("load-btn");
      const params = new URLSearchParams(window.location.search);
      const selectedFromUrl = params.get("sketch");

      async function listSketches() {
        const resp = await fetch("./");
        const html = await resp.text();
        const doc = new DOMParser().parseFromString(html, "text/html");
        const files = Array.from(doc.querySelectorAll("a"))
          .map((a) => a.getAttribute("href") || "")
          .filter((href) => href.endsWith(".js"))
          .map((href) => href.replace(/^.\//, ""))
          .filter((name) => !name.endsWith("p5.min.js"))
          .sort();
        return [...new Set(files)];
      }

      function loadSketchScript(fileName) {
        statusEl.textContent = "Loading " + fileName + "...";
        const script = document.createElement("script");
        script.src = fileName;
        script.onload = () => {
          statusEl.textContent = "Loaded " + fileName;
        };
        script.onerror = () => {
          statusEl.textContent = "Failed to load " + fileName;
        };
        document.body.appendChild(script);
      }

      function setSketchInUrl(fileName) {
        const u = new URL(window.location.href);
        u.searchParams.set("sketch", fileName);
        window.location.href = u.toString();
      }

      loadBtn.addEventListener("click", () => {
        const file = selectEl.value;
        if (file) setSketchInUrl(file);
      });

      listSketches()
        .then((files) => {
          if (!files.length) {
            statusEl.textContent = "No .js sketches found in this folder.";
            return;
          }

          for (const f of files) {
            const opt = document.createElement("option");
            opt.value = f;
            opt.textContent = f;
            selectEl.appendChild(opt);
          }

          const chosen = files.includes(selectedFromUrl) ? selectedFromUrl : files[0];
          selectEl.value = chosen;
          loadSketchScript(chosen);
        })
        .catch(() => {
          statusEl.textContent = "Could not list files. Use a local web server.";
        });
    </script>
  </body>
</html>
